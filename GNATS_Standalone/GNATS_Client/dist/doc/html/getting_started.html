<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NATS: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="nats_customized.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NATS
   </div>
   <div id="projectbrief">National Airspace Trajectory-Prediction System</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('getting_started.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_firstProgram">First Program</a></li>
<li class="level1"><a href="#sec_loadLibrary">1. Load NATS library</a></li>
<li class="level1"><a href="#sec_getNATSClient">2. Get NATSClient and interfaces</a></li>
<li class="level1"><a href="#sec_writeLogic">3. Write your logic</a></li>
<li class="level1"><a href="#sec_disconnectFromNATSServer">4. Disconnect from NATS Server</a></li>
</ul>
</div>
<div class="textblock"><p>In this topic we will talk about how to get NATS Client to work from scratch. The overall work of NATS is done by the interaction of NATS Server and Client. Please refer to the document of NATS Server for the information about how to start the server.</p>
<p>Open a terminal console, navigate to NATS_Server directory. Type </p><div class="fragment"><div class="line">./run</div></div><!-- fragment --><p>Now, we have a running NATS Server, you should be able to see the screen text like <img src="screenshot_starting_server.png" alt="" class="inline"/>
<p><br />
</p>
<h1><a class="anchor" id="sec_firstProgram"></a>
First Program</h1>
<p>From here, we can start to develop our first NATS client program.</p>
<p>Use <b>NATS_Client/sample/basic_python_example.py</b> as an example.</p>
<p>The basic procedure to write a NATS client program is to: </p><ol>
<li>
Load NATS library </li>
<li>
Get NATSClient and interfaces </li>
<li>
Write your logic </li>
<li>
Disconnect from NATS Server </li>
</ol>
<p><br />
</p>
<p>The following steps illustrate the basic concept no matter you are using Python or MATLAB.</p>
<h1><a class="anchor" id="sec_loadLibrary"></a>
1. Load NATS library</h1>
<ul>
<li>
If you are writing Python<br />
 <div class="fragment"><div class="line"><span class="comment"># Use Jpype as a bridge to communicate with Java</span></div><div class="line"><span class="keyword">from</span> jpype <span class="keyword">import</span> *</div><div class="line">  </div><div class="line"><span class="comment"># Put all required Java library here</span></div><div class="line">classpath = <span class="stringliteral">&quot;dist/nats-client.jar:dist/nats-shared.jar:dist/json.jar:dist/rmiio-2.1.2.jar:dist/commons-logging-1.2.jar&quot;</span></div><div class="line"></div><div class="line"><span class="comment"># Start Java environment</span></div><div class="line">startJVM(getDefaultJVMPath(), <span class="stringliteral">&quot;-ea&quot;</span>, <span class="stringliteral">&quot;-Djava.class.path=%s&quot;</span> % classpath)</div></div><!-- fragment -->  </li>
<li>
If you are writing MATLAB<br />
 <div class="fragment"><div class="line">% Clear java variables in MATLAB</div><div class="line">clear java;</div><div class="line"></div><div class="line">javaaddpath(<span class="stringliteral">&#39;dist/nats-client.jar&#39;</span>,<span class="stringliteral">&#39;-end&#39;</span>);</div><div class="line">javaaddpath(<span class="stringliteral">&#39;dist/nats-shared.jar&#39;</span>,<span class="stringliteral">&#39;-end&#39;</span>);</div><div class="line">javaaddpath(<span class="stringliteral">&#39;dist/json.jar&#39;</span>,<span class="stringliteral">&#39;-end&#39;</span>);</div><div class="line">javaaddpath(<span class="stringliteral">&#39;dist/rmiio-2.1.2.jar&#39;</span>,<span class="stringliteral">&#39;-end&#39;</span>);</div><div class="line">javaaddpath(<span class="stringliteral">&#39;dist/commons-logging-1.2.jar&#39;</span>,<span class="stringliteral">&#39;-end&#39;</span>);</div></div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="sec_getNATSClient"></a>
2. Get NATSClient and interfaces</h1>
<div style="margin-left: 25px;"> <div class="fragment"><div class="line">NATSClientFactory = JClass(<span class="stringliteral">&#39;NATSClientFactory&#39;</span>)</div><div class="line">natsClient = NATSClientFactory.getNATSClient()</div><div class="line"></div><div class="line"><span class="comment"># Get SimulationInterface</span></div><div class="line">simulationInterface = natsClient.getSimulationInterface()</div></div><!-- fragment --></div><div style="margin-left: 25px;"> As you see, we call NATSClientFactory.getNATSClient() function to get the NATSClient instance. After that, we obtain another interface(SimulationInterface) from it. For the detail interfaces we can get, please refer to the <a href="classNATSClient.html">API Document</a>. </div><h1><a class="anchor" id="sec_writeLogic"></a>
3. Write your logic</h1>
<div style="margin-left: 25px;"> NATS API provides diversity of purposes in aircraft trajectory simulation. Users are able to accomplish various tasks using NATS API. For a demo purpose, we use this simple example to explain a typical logic about trajectory simulation. The same example can be seen in NATS_Client/sample/basic_python_example.py <div class="fragment"><div class="line"><span class="comment"># Clear trajectory data</span></div><div class="line">sim.clear_trajectory()</div><div class="line"></div><div class="line"><span class="comment"># Load wind data</span></div><div class="line">environmentInterface.load_rap(<span class="stringliteral">&quot;share/tg/rap&quot;</span>) <span class="comment"># Here the parameters specify the file and path on server.  Please don&#39;t change it.</span></div><div class="line"></div><div class="line"><span class="comment"># Load aircraft data</span></div><div class="line">aircraftInterface.load_aircraft(<span class="stringliteral">&quot;share/tg/trx/TRX_DEMO_SFO_PHX_GateToGate.trx&quot;</span>, <span class="stringliteral">&quot;share/tg/trx/TRX_DEMO_SFO_PHX_mfl.trx&quot;</span>) <span class="comment"># Here the parameters specify the file and path on server.  Please don&#39;t change it.</span></div><div class="line"></div><div class="line"><span class="comment"># Set up simulation</span></div><div class="line"><span class="comment"># Set total simulation time to 11000 seconds, time step is 10 seconds</span></div><div class="line">sim.setupSimulation(11000, 10)</div><div class="line"></div><div class="line"><span class="comment"># Start simulation</span></div><div class="line">sim.start()</div><div class="line"></div><div class="line"><span class="comment"># This while loop block is to check the simulation status.  Due to aircraft data size and different simulation time, there is no method to forsee how much time the simulation will take.  Therefore, we constantly check simulation status.  When the simulation status is ENDED, we can continue.</span></div><div class="line"><span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line">  server_runtime_sim_status = sim.get_runtime_sim_status()</div><div class="line">  <span class="keywordflow">if</span> (server_runtime_sim_status == NATS_SIMULATION_STATUS_ENDED) :</div><div class="line">      <span class="keywordflow">break</span></div><div class="line">  <span class="keywordflow">else</span>:</div><div class="line">      time.sleep(1)</div><div class="line"></div><div class="line"><span class="comment"># Write trajectory result to a file</span></div><div class="line">millis = int(round(time.time() * 1000))</div><div class="line"><span class="keywordflow">print</span> <span class="stringliteral">&quot;Outputting trajectory data.  Please wait....&quot;</span></div><div class="line"><span class="comment"># The trajectory output file will be saved on NATS_Server side</span></div><div class="line">sim.write_trajectories(<span class="stringliteral">&quot;Sample_output_trajectory_&quot;</span> + str(millis) + <span class="stringliteral">&quot;.csv&quot;</span>)</div><div class="line"></div><div class="line"><span class="comment"># Release aircraft data</span></div><div class="line">aircraftInterface.release_aircraft()</div><div class="line"></div><div class="line"><span class="comment"># Release wind data</span></div><div class="line">environmentInterface.release_rap()</div></div><!-- fragment --> </div><h1><a class="anchor" id="sec_disconnectFromNATSServer"></a>
4. Disconnect from NATS Server</h1>
<div style="margin-left: 25px;"> In client program, simply call <div class="fragment"><div class="line">natsClient.disConnect()</div></div><!-- fragment --> <br />
 If you are writing Python, you still need to shut down the JVM environment. <div class="fragment"><div class="line">shutdownJVM()</div></div><!-- fragment --> </div><p><br />
 </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
</body>
</html>
